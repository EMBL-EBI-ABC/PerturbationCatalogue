nextflow.enable.dsl = 2

process {
  errorStrategy = 'retry'
  maxRetries    = 2
}

profiles {
  standard { }
  gcp_batch {
    workDir = 'gs://perturbation-catalogue-lake/perturbseq/nf_differential_expression/work'

    process {
      executor = 'google-batch'     // Nextflowâ€™s Google Batch executor
      container = 'europe-west2-docker.pkg.dev/prj-ext-dev-pertcat-437314/nf-containers/scperturb-nf:latest'
      errorStrategy = 'retry'
      maxRetries = 2
      withLabel:bigmem { cpus = 8; memory = '64 GB' }
      withLabel:light  { cpus = 2; memory = '8 GB'  }
      withLabel:bigmemcpu  { cpus = 16; memory = '64 GB'  }
    }

    google {
        project = 'prj-ext-dev-pertcat-437314'
        location = 'europe-west2'
      batch {
        bootDiskSize = '50 GB'
        spot = true
        serviceAccountEmail = '959149465821-compute@developer.gserviceaccount.com'
      }
    }
  }
}

params {
  outdir = "results"
}